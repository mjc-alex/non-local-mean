


从4个角度测。
- [ ] 图像大小（6种）（最后三个没测）
- [x] 搜索窗口大小（2种）
- [x] 模板窗口大小（5种）
- [ ] block和grid的配置（block_x测32，64，128, 256.grid_y 测8,16,32,64,128）

实验平台4060laptop，cuda12.1。时间统计单位均为ms，核函数100次运行的平均时间
## 全局内存

### 搜索窗口和模板窗口
取1024\*1024的图片大小，block_x = 32, grid_y = 64的配置

|     | 3     | 5     | 7     | 9     | 11    |
| --- | ----- | ----- | ----- | ----- | ----- |
| 21  | 125.3 | 125.6 | 126.3 | 128.2 | 148.1 |
| 35  | 349.5 | 350.2 | 351.4 | 355.6 | 413.7 |
### 图片大小
block_x = 32, grid_y = 64的配置，21, 5的窗口设置

| 256 | 512  | 1024  | 2048  | 1280 720 | 1920 1080 | 2560 1440 |
| --- | ---- | ----- | ----- | -------- | --------- | --------- |
| 8.3 | 31.7 | 125.5 | 492.5 |          |           |           |


### grid and block
取1024\*1024的图片大小，21, 5的窗口设置

|     | 32    | 64    | 128   | 256   |
| --- | ----- | ----- | ----- | ----- |
| 8   | 126.1 | 137.5 | 137.5 | 183.2 |
| 16  | 131.7 | 131.7 | 139.8 | 137.4 |
| 32  | 126.7 | 126.7 | 126.7 | 137.4 |
| 64  | 125.5 | 126.3 | 126.3 | 126.0 |
| 128 | 123.3 | 123.3 | 123.3 | 126.0 |

## 共享内存
### 搜索窗口和模板窗口
取1024\*1024的图片大小，block(8, 8), grid(image_x/8, image_y/8)

|     | 3     | 5     | 7     | 9     | 11    |
| --- | ----- | ----- | ----- | ----- | ----- |
| 21  | 85.5  | 85.3  | 93.5  | 87.0  | 114.9 |
| 35  | 243.4 | 243.8 | 239.7 | 262.4 | 330.3 |

### 图片大小
block(8, 8), grid(image_x/8, image_y/8)的配置，21, 5的窗口设置

| 256  | 512   | 1024  | 2048   | 1280 720 | 1920 1080 | 2560 1440 |
| ---- | ----- | ----- | ------ | -------- | --------- | --------- |
| 5.6  | 21.9  | 85.4  | 336.2  |          |           |           |
| 2795 | 11322 | 44233 | 173560 |          |           |           |


### grid and block
取1024\*1024的图片大小，21, 5的窗口设置
grid, block为二维块，grid大小适应block

| 2     | 4     | 8    | 3     |
| ----- | ----- | ---- | ----- |
| 688.7 | 178.3 | 85.3 | 302.8 |


## shared mem
- Maximum amount of shared memory per SM: 100KB
- Maximum amount of shared memory per thread block: 99KB
	- above 48 KB requires dynamic shared memory
`cudaFuncSetAttribute(KernelName,cudaFuncAttributeMaxDynamicSharedMemorySize, 96 * (1 << 10));`
## PSNR SSIM

 lena            camera           book              sun

|      | GM    | SH    | GM    | SH    | GM    | SH    | GM    | SH    |
| ---- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- |
| PSNR | 33.15 | 34.37 | 33.39 | 34.63 | 32.56 | 33.52 | 35.45 | 36.36 |
| SSIM | 0.881 | 0.898 | 0.910 | 0.924 | 0.921 | 0.936 | 0.914 | 0.924 |

![](images/Pasted%20image%2020240515215944.png)![](images/Pasted%20image%2020240515220026.png)
![](images/Pasted%20image%2020240516162455.png)![](images/Pasted%20image%2020240516162607.png)
Driver Version: 535.171.04   CUDA Version: 12.2
opencv 4.5.4